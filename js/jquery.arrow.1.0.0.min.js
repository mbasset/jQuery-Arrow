/* 
 * Version: 1.0.0
 * Created: 2011-04-24
 * Updated: 2011-04-24
 * Author: 	Matthew Basset
 * 
 * Licensed under the MIT license: http://www.opensource.org/licenses/mit-license.php
 * 
 */
(function(c){var d=0;function b(e){this.value=e;this.toString=function(){return"The argument '"+this.value+"' is invalid."}}function a(f,e){this.defaults={image:"arrow.png",image_orientation:"up",style:"topleft",movement_amount:30,movement_speed:650,persist:true,trigger_event:"",stop_event:"",height:"auto",width:"auto"};this.options=c.extend(this.defaults,e);this.parent=f;this.instance=null;this.persisting=false;this.init=function(){var j=this.parent,l=this.options,i=l.height,g=l.width,h="",k=null;h="<img id='arrow_"+d+"' class='jarrow' src='"+l.image+"'";if(i!="auto"){h+="height='"+i+"'"}if(i!="auto"){h+="width='"+g+"'"}h+=">";d+=1;j.after(h);arrow=c("#arrow_"+(d-1)+".jarrow");this.instance=arrow;arrow.data("arrow",this);k=this.base_position();arrow.css("position","absolute");arrow.css("top",k.top);arrow.css("left",k.left);arrow.rotate(k.rotation);if(l.trigger_event==""||l.trigger_event===null){this.animate()}else{this.parent.bind(l.trigger_event,function(){c(this).data("arrow").animate()})}if(!(l.stop_event==""||l.stop_event===null)){this.parent.bind(l.stop_event,function(){c(this).data("arrow").stop()})}};this.destroy=function(){this.stop();this.parent.removeData("arrow").unbind(this.options.trigger_event).unbind(this.options.stop_event);this.instance.removeData("arrow").remove()};this.base_position=function(){var i=this.options,s=0,r=this.instance.height(),l=this.instance.width(),p=this.parent.height(),m=this.parent.width(),q=this.parent.position().top+parseFloat(this.parent.css("marginTop").replace("px","")),k=this.parent.position().left+parseFloat(this.parent.css("marginLeft").replace("px","")),j="+=0",g="+=0",h=i.movement_amount,n=Math.sqrt(Math.pow(h,2)/2);switch(i.image_orientation){case"up":s=0;break;case"down":s=180;k-=(l/2);break;case"left":s=90;l=this.instance.height();r=this.instance.width();break;case"right":s=270;l=this.instance.height();r=this.instance.width();k-=l/2;break;default:s=(360-(i.image_orientation%360))}switch(i.style){case"top":s+=180;q-=r;k+=m/2;j="-="+h;break;case"bottom":s+=0;q+=p;k+=m/2;j="+="+h;break;case"left":s+=90;q+=p/2-l/2;k-=r/2;g="-="+h;break;case"right":s+=270;q+=p/2-l/2;k+=m+r/2;g="+="+h;break;case"topleft":s+=135;q-=r;k-=l/2;j="-="+n;g="-="+n;break;case"bottomleft":s+=45;q+=p;k-=l/2;j="+="+n;g="-="+n;break;case"topright":s+=225;q-=r;k+=m+l/2;j="-="+n;g="+="+n;break;case"bottomright":s+=315;q+=p;k+=m+l/2;j="+="+n;g="+="+n;break;default:throw new b(i.style)}return{rotation:s,top:q,left:k,direction_top:j,direction_left:g}};this.animate=function(g){var h=this.options;if(this.persisting&&!g){return}if(h.persist){this.persisting=true}if(this.persisting){this.animate_forward(function(){c(this).data().arrow.animate_reverse(function(){c(this).data().arrow.animate(true)})})}else{this.animate_forward(function(){c(this).data().arrow.animate_reverse()})}};this.animate_forward=function(g){var h=this.options,i=this.base_position();this.instance.clearQueue().animate({top:i.direction_top,left:i.direction_left},h.movement_speed,g)};this.animate_reverse=function(g){var h=this.options;this.instance.animate(this.base_position(),h.movement_speed,g)};this.stop=function(){var g=this.options;this.persisting=false;this.instance.stop().animate(this.base_position(),g.movement_speed)}}c.fn.extend({arrow:function(e){return this.each(function(){var g=e,f=null;if(c(this).data("arrow")!=undefined){if(e=="destroy"){c(this).data().arrow.destroy()}}else{f=new a(c(this),g);f.init();c(this).data("arrow",f)}})}})})(jQuery);